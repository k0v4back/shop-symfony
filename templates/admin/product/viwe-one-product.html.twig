{% extends "admin/main-page.html.twig" %}

{% block body %}

    <ol class="breadcrumb">
        <li class="breadcrumb-item">
            <a href="{{ path('main_page') }}">Главная</a>
        </li>
        <li class="breadcrumb-item active">
            <a href="{{ path('view_all_products') }}">Товары</a>
        </li>
        <li class="breadcrumb-item active">{{ product.title }}</li>
    </ol>

    {% for message in app.flashes('success') %}
        <div class="alert alert-success">
            {{ message }}
        </div>
    {% endfor %}

    {% for message in app.flashes('primary') %}
        <div class="alert alert-primary">
            {{ message }}
        </div>
    {% endfor %}

    <table class="table table-bordered">
        <thead>
        <tr>
            <th scope="col">Название</th>
            <th scope="col">Описание</th>
            <th scope="col">Цена</th>
        </tr>
        </thead>
        <tbody>
        <tr>
            <td>{{ product.title }}</td>
            <td>{{ product.description }}</td>
            <td>{{ product.price }}</td>
        </tr>
        </tbody>
    </table>
    <br>

    <div class="card mb-3">
        <div class="card-body">
            <h4 class="card-title">Модификация товара</h4>
            {% for mod in product.modification %}
                <div class="panel panel-warning">
                    <div class="panel-body">
                        <table class="table table-bordered">
                            <thead>
                            <tr>
                                <th scope="col">Название</th>
                                <th scope="col">Описание</th>
                            </tr>
                            </thead>
                            <tbody>
                            <tr>
                                <td>{{ mod.title }}</td>
                                <td>{{ mod.text }}</td>
                            </tr>
                            </tbody>
                        </table>
                    </div>
                </div>
            {% endfor %}
        </div>
    </div>

    <div class="card mb-3">
        <div class="card-body">
            <h4 class="card-title">Метки для товара</h4>
            <div class="panel panel-warning">
                <div class="panel-body">
                    <table class="table table-bordered">
                        <thead>
                        <tr>
                            <th scope="col">#</th>
                            <th scope="col">Название</th>
                            <th scope="col">Действия</th>
                        </tr>
                        </thead>
                        <tbody>
                        {% for tag in product.tag %}
                            <tr id="{{ path('delete_tag_modal', {'id': tag.id}) }}">
                                <th scope="row">{{ loop.index }}</th>
                                <td>{{ tag.tagId|getTag(tag.tagId) }}</td>
                                <td>
                                    <button class="btn btn-danger btn-sm deleteTag brl-btn"
                                            data-path="{{ path('delete_tag_modal', {'id': tag.id}) }}">
                                        <i class="fas fa-trash-alt"></i>
                                    </button>
                                </td>
                            </tr>
                        {% endfor %}
                        </tbody>
                    </table>
                </div>
            </div>
            <button type="button" class="btn btn-primary btn-sm" data-toggle="modal" data-target="#tagFormModal">
                Загрузить ещё метку
            </button>
        </div>
    </div>
    <!-- Modal -->
    <div class="modal fade" id="tagFormModal" tabindex="-1" role="dialog" aria-labelledby="tagFormModalLabel"
         aria-hidden="true">
        <div class="modal-dialog" role="document">
            <div class="modal-content formCreateTag">
                <div class="modal-header">
                    <h5 class="modal-title" id="tagFormModalLabel">Создать метку</h5>
                    <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                        <span aria-hidden="true">&times;</span>
                    </button>
                </div>
                <div class="modal-body">
                    {{ form_start(tagForm, {'attr': {'class': 'formCreateTag'}}) }}
                    {{ form_row(tagForm.tag_id, {'label': 'Доступные метки'}) }}
                    {{ form_end(tagForm) }}
                </div>
            </div>
        </div>
    </div>


    <div class="card mb-3">
        <div class="card-body">
            <h4 class="card-title">Картинки товара</h4>
            <div class="row text-center text-lg-left">

                {% for photo in photos %}
                    <div class="col-lg-3 col-md-4 col-6 photos" id="{{ path('delete_photo', {'id': photo.id}) }}">
                            <img class="img-fluid img-thumbnail" src="{{ asset('upload/product/' ~ photo.name) }}"
                                 alt="">
                            <button class="btn btn-danger btn-sm deletePhoto brl-btn2"
                                    data-path="{{ path('delete_photo', {'id': photo.id}) }}"
                                    style="margin-top: 7px; margin-bottom: 20px;">
                                <i class="fas fa-trash-alt"></i>
                            </button>

                        <a href="{{ path('photo_move_up', {'id': app.request.get('id'), 'photo': photo.id}) }}">Up</a>
                    </div>
                {% endfor %}
            </div>
            <button type="button" class="btn btn-primary btn-sm" data-toggle="modal" data-target="#photoFormModal">
                Загрузить фотографии
            </button>
        </div>
    </div>
    <!-- Modal -->
    <div class="modal fade" id="photoFormModal" tabindex="-1" role="dialog" aria-labelledby="photoFormModal"
         aria-hidden="true">
        <div class="modal-dialog" role="document">
            <div class="modal-content formCreateTag">
                <div class="modal-header">
                    <h5 class="modal-title" id="photoFormModal">Создать метку</h5>
                    <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                        <span aria-hidden="true">&times;</span>
                    </button>
                </div>
                <div class="modal-body">
                    {{ form_start(photoForm) }}
                    {{ form_row(photoForm.name, {'label': 'Картинки'}) }}
                    {{ form_end(photoForm) }}
                </div>
            </div>
        </div>
    </div>

{% endblock %}

{% block javascripts %}
    {{ parent() }}

    <script>
        $(document).on('click', 'button.deleteTag', function () {
            that = $(this);
            var new_message_path = $(".brl-btn").attr("data-path");
            $.ajax({
                url: new_message_path,
                type: "POST",
                dataType: "json",
                data: {
                    "data": "some_var_value"
                },
                async: true,
                success: function () {
                    document.getElementById(new_message_path).style.display = "none";
                    document.getElementById(new_message_path).innerHTML = "";
                }
            });
            return false;
        });


        $(document).on('click', 'button.deletePhoto', function () {
            that = $(this);
            var url = $(".brl-btn2").attr("data-path");
            $.ajax({
                url: url,
                type: "POST",
                dataType: "json",
                data: {
                    "data": "some_var_value"
                },
                async: true,
                success: function () {
                    document.getElementById(url).style.display = "none";
                    document.getElementById(url).innerHTML = "";
                }
            });
            return false;
        });

    </script>
{% endblock %}